package au.com.codeka.warworlds.server.ctrl;

import java.sql.Statement;

import au.com.codeka.warworlds.server.RequestException;
import au.com.codeka.warworlds.server.data.DB;
import au.com.codeka.warworlds.server.data.SqlStmt;
import au.com.codeka.warworlds.server.model.Sector;

/**
 * This class generates a new sector, populated with stars and whatnot.
 */
public class SectorGenerator {

    public Sector generate(long x, long y) throws RequestException {
        String sql = "INSERT INTO sectors (x, y, distance_to_centre, num_colonies) VALUES (?, ?, ?, ?)";
        try (SqlStmt stmt = DB.prepare(sql, Statement.RETURN_GENERATED_KEYS)) {
            Sector sector = new Sector(x, y);

            stmt.setLong(1, sector.getX());
            stmt.setLong(2, sector.getY());
            stmt.setDouble(3, sector.getDistanceToCentre());
            stmt.setInt(4, sector.getNumColonies());
            stmt.update();
            sector.setID(stmt.getAutoGeneratedID());

            return sector;
        } catch (Exception e) {
            throw new RequestException(500, e);
        }
    }
}
