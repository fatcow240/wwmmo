<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<?eclipse.ant.import?>
<project name="server-installer">
    <property name="output.location" value="../../deploy"/>
    <property name="deploy.filename" value="../../server.zip" />

    <!--
      This target packages all of the server output into the wwmmo/deploy folder. JAR files go
      in the bin directory, data in the data directory and so on.
    -->
    <target name="package" depends="build">
        <jar destfile="${output.location}/bin/common.jar"
             basedir="${common.location}/bin" />
        <jar destfile="${output.location}/bin/server.jar"
             basedir="bin" />
        <copy todir="${output.location}/bin">
          <fileset file="libs/*.jar" />
          <fileset file="../jetty/lib/*.jar" />
          <fileset file="${common.location}/libs/*.jar" />
        </copy>
        <copy todir="${output.location}/data">
          <fileset dir="data" excludes="**/.svn" />
        </copy>
        <copy todir="${output.location}">
          <fileset dir="scripts" />
        </copy>
    </target>

    <!--
      Takes the contents of the package (which will be in the wwmmo/deploy folder) and pushes
      it to GCE, in the "stage" directory, ready to be pushed live.
    -->
    <target name="deploy" depends="package">
        <echo message="${ant.project.name}: deploying ${deploy.filename}..."/>
        <zip destfile="${deploy.filename}" basedir="${output.location}" />
        <exec executable="gcutil">
            <arg value="push" />
            <arg value="--zone=us-central1-b" />
            <arg value="warworlds-main" />
            <arg value="${deploy.filename}" />
            <arg value="/home/dean" />
        </exec> 
    </target>
</project>