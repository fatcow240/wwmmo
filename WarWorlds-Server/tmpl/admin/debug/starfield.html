{% extends "admin/skeleton.html" %}

{% block head %}
	<style>
		#update-form textarea {
			width: 800px;
			height: 400px;
		}
		
		form input[type=text] {
			width: 100px;
		}
		#star-input-form input[type=text] {
			width: 400px;
		}
	</style>
{% endblock %}

{% block content %}
	<h1>Starfield</h1>
	<p>Enter the coordinates of the sector you want to look at, and click &ldquo;Display&rdquo;.
	<form id="sector-input-form">
		Sector: (
			<input type="number" name="x1" value="0">,
			<input type="number" name="y1" value="0">
		) - (
			<input type="number" name="x2">,
			<input type="number" name="y2">
		)
		<input type="submit" value="Display">
	</form>
	<form id="star-input-form">
		Star: <input type="text" name="starKey" value="">
		<input type="submit" value="Display">
	</form>
	<form id="update-form">
		<textarea name="sectors"></textarea>
	</form>
	<script>
		$("#sector-input-form").on("click", "input[type=submit]", function(evnt) {
			evnt.preventDefault();
			var $x1 = $("#sector-input-form input[name=x1]");
			var $x2 = $("#sector-input-form input[name=x2]");
			var $y1 = $("#sector-input-form input[name=y1]");
			var $y2 = $("#sector-input-form input[name=y2]");

			if ($x2.val() == "" || $y2.val() == "") {
				$x2.val(parseInt($x1.val()) + 1);
				$y2.val(parseInt($y1.val()) + 1);
			}

			var coords = $x1.val()+","+$y1.val()+":"+$x2.val()+","+$y2.val();
			$.ajax({
				url: "/api/v1/sectors?coords="+coords,
				dataType: "json",
				success: function (data) {
					$("#update-form textarea").val(JSON.stringify(data, null, "  "));
				},
				error: function() {
					alert("An error occured fetching starfield data. Check server logs.");
				}
			});
		});

		$("#star-input-form").on("click", "input[type=submit]", function(evnt) {
			evnt.preventDefault();
			var $starKey = $("#star-input-form input[name=starKey]");

			var url = "/api/v1/stars/"+$starKey.val();
			$.ajax({
				url: url,
				dataType: "json",
				success: function(data) {
					$("#update-form textarea").val(JSON.stringify(data, null, "  "));
				},
				error: function() {
					alert("An error occured fetching starfield data. Check server logs.");
				}
			});
		});
	</script>
{% endblock %}