{% extends "admin/skeleton.html" %}

{% block head %}
  <style>
    textarea#search-results {
      width: 800px;
      height: 400px;
    }
    form {
      position: relative;
      height: 28pt;
      line-height: 28pt;
      width: 500pt;
    }
    form input[type=submit] {
      position: absolute;
      right: 0;
    }
    form input[type=text] {
      position: absolute;
      top: 0; left: 60pt;
      bottom: 0; right: 70pt;
      border: solid 1px black;
    }
    form label {
      display: block;
      position: absolute;
      left: 0; width: 60pt;
      top: 0; bottom: 0;
    }
    form#find-byemailidname input[type=text] {
      right: 130pt;
    }
    form#find-byemailidname input[type=checkbox] {
      position: absolute;
      right: 110pt;
      top: 6pt;
    }
    form#find-byemailidname label[for=search-details] {
      position: absolute;
      top: 0; bottom: 0;
      left: 392pt;
      line-height: 28pt
    }

    form input[type=text]#create-empire-name {
      right: 100pt;
    }
  </style>
{% endblock %}

{% block content %}
  <h1>Empires</h1>
  <p>To find the details of a given Empire, enter the email address below of the user
     who owns the Empire, or the Empire's key, then click &ldquo;Search&rdquo;.
  <form id="find-byemailidname">
    <label for="search-email">Search:</label>
    <input type="text" id="search-value" placeholder="Key, email or name" />
    <input type="checkbox" id="search-details">
    <label for="search-details" title="(You must specify key for this)">Details</label>
    <input type="submit" value="Search" />
  </form>
  <form id="create-empire">
    <label for="create-empire-name">Name:</label>
    <input type="text" id="create-empire-name" />
    <input type="submit" value="Create Empire" />
  </form>
  <textarea id="search-results"></textarea>
  <script>
    $("#find-byemailidname").on("submit", function(evnt) {
      evnt.preventDefault();

      var url = "";
      var inp = $(this).find("input[type=text]");
      if ($(this).find("input[type=checkbox]").prop("checked")) {
        url = "/api/v1/empires/"+inp.val()+"/details";
      } else {
        url = "/api/v1/empires?search="+inp.val();
      }

      $.ajax({
        url: url,
        dataType: "json",
        success: function (data) {
          $("#search-results").val(JSON.stringify(data, null, "  "));
        },
        error: function(xhr, status, err) {
          if (xhr.status == 404) {
            $("#search-results").val("No empire!");
          } else {
            alert("An error occured, check server logs: " + xhr.status);
          }
        }
      });
    });

    $("#create-empire").on("submit", function(evnt) {
      evnt.preventDefault();

      var url = "/api/v1/empires";

      $.ajax({
        url: url,
        type: "PUT",
        contentType: "application/json",
        data: JSON.stringify({display_name: $(this).find("input[type=text]").val(),
                              state: 1}),
        success: function (data) {
          $("#search-results").val(JSON.stringify(data, null, "  "));
        },
        error: function(xhr, status, err) {
          alert("An error occured, check server logs: " + xhr.status);
        }
      });
    });
  </script>
{% endblock %}